function startRoulette() {
  if (spinning || !currentList.length) {
    alert('名簿がありません');
    return;
  }
  spinning = true;

  const sound = soundFiles[Math.floor(Math.random() * soundFiles.length)];
  audio = new Audio(baseUrl + sound);

  audio.addEventListener('loadedmetadata', () => {
    if (!currentList.length) {
      alert('名簿が空です（クラスが選ばれていない可能性）');
      spinning = false;
      return;
    }

    const duration = audio.duration; // 音声の長さ（秒）
    const totalSteps = 38; // 実質的な回転回数（フェイント除く）
    const baseInterval = (duration * 1000) / (totalSteps + 2); // フェイント分含めた平均間隔

    audio.play();

    let spins = 0;

    const step = () => {
      if (spins >= totalSteps) {
        // フェイント：一度止まったように見せる
        setTimeout(() => {
          const fakeIdx = (currentIndex + currentList.length - 1) % currentList.length;
          document.getElementById('roulette').textContent = currentList[fakeIdx];

          // そしてもう1回だけ動く！
          setTimeout(() => {
            const selIdx = (fakeIdx + 1) % currentList.length;
            const selected = currentList[selIdx];
            document.getElementById('roulette').textContent = selected;
            document.getElementById('history').innerHTML += `<li>${selected}</li>`;
            if (!allowDuplicates) {
              currentList.splice(selIdx, 1);
            }
            currentIndex = 0;
            spinning = false;

            if (audio) {
              audio.pause();
              audio.currentTime = 0;
            }

            const el = document.getElementById("roulette");
            el.classList.add("highlight");
